# MLSharp 3D Maker

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.128+-green.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
</div>

# ä½¿ç”¨è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

MLSharp-3D-Maker æ˜¯ä¸€ä¸ªåŸºäº Apple SHaRP æ¨¡å‹çš„ 3D é«˜æ–¯æ³¼æº…ï¼ˆ3D Gaussian Splattingï¼‰ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥ä»å•å¼ ç…§ç‰‡ç”Ÿæˆé«˜è´¨é‡çš„ 3D æ¨¡å‹ã€‚

### é¡¹ç›®å®Œæˆåº¦

| æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|------|------|--------|------|
| æ ¸å¿ƒåŠŸèƒ½ | âœ… å®Œæˆ | 100% | å›¾åƒåˆ° 3D æ¨¡å‹è½¬æ¢ |
| GPU åŠ é€Ÿ | âœ… å®Œæˆ | 100% | NVIDIA/AMD/Intel æ”¯æŒ |
| é…ç½®ç®¡ç† | âœ… å®Œæˆ | 100% | å‘½ä»¤è¡Œ + é…ç½®æ–‡ä»¶ |
| æ—¥å¿—ç³»ç»Ÿ | âœ… å®Œæˆ | 100% | loguru ä¸“ä¸šæ—¥å¿— |
| å¼‚æ­¥å¤„ç† | âœ… å®Œæˆ | 100% | ProcessPoolExecutor |
| å•å…ƒæµ‹è¯• | âœ… å®Œæˆ | 90% | æ ¸å¿ƒç±»æµ‹è¯•è¦†ç›– |
| API æ¥å£ | âœ… å®Œæˆ | 80% | é¢„æµ‹ + å¥åº·æ£€æŸ¥ |
| ç›‘æ§æŒ‡æ ‡ | âœ… å®Œæˆ | 90% | Prometheus é›†æˆ + æ€§èƒ½ç›‘æ§ |
| æ–‡æ¡£ | âœ… å®Œæˆ | 85% | README + é…ç½®ç¤ºä¾‹ |
| API æ–‡æ¡£ | ğŸ”„ å¾…å¼€å‘ | 0% | Swagger/OpenAPI |
| è®¤è¯æˆæƒ | ğŸ”„ å¾…å¼€å‘ | 0% | API Key/JWT |

**æ€»ä½“å®Œæˆåº¦: 92%**

### æœ€æ–°æ›´æ–°ï¼ˆ2026-01-29ï¼‰

**ğŸš€ æ¢¯åº¦æ£€æŸ¥ç‚¹ v7.3**
- âœ… **æ¢¯åº¦æ£€æŸ¥ç‚¹åŠŸèƒ½** - å‡å°‘æ˜¾å­˜å ç”¨ 30-50%
- âœ… **æ™ºèƒ½å†…å­˜ä¼˜åŒ–** - é€šè¿‡é‡æ–°è®¡ç®—ä¸­é—´æ¿€æ´»å€¼èŠ‚çœæ˜¾å­˜
- âœ… **å¯é…ç½®é€‰é¡¹** - æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶
- âœ… **é»˜è®¤å…³é—­** - ä¸å½±å“æ­£å¸¸ä½¿ç”¨ï¼ŒæŒ‰éœ€å¯ç”¨
- âœ… **è¯¦ç»†æ–‡æ¡£** - ä¹è§‚åŒ–æ–¹æ¡ˆæ–‡æ¡£

**ğŸš€ ç›‘æ§æŒ‡æ ‡ v7.2**
- âœ… **Prometheus é›†æˆ** - å®Œæ•´çš„ Prometheus æŒ‡æ ‡æ”¯æŒ
- âœ… **æ€§èƒ½ç›‘æ§** - HTTP è¯·æ±‚ã€é¢„æµ‹è¯·æ±‚ã€å“åº”æ—¶é—´ç»Ÿè®¡
- âœ… **GPU ç›‘æ§** - å®æ—¶ GPU å†…å­˜ä½¿ç”¨é‡å’Œåˆ©ç”¨ç‡ç›‘æ§
- âœ… **ä»»åŠ¡è¿½è¸ª** - æ´»è·ƒä»»åŠ¡æ•°å’Œå„é˜¶æ®µè€—æ—¶ç»Ÿè®¡
- âœ… **é…ç½®æ”¯æŒ** - é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ç›‘æ§åŠŸèƒ½

**ğŸš€ è¾“å…¥å°ºå¯¸å‚æ•° v7.1**
- âœ… **è¾“å…¥å°ºå¯¸å‚æ•°** - æ”¯æŒè‡ªå®šä¹‰æ¨ç†è¾“å…¥å°ºå¯¸ï¼ˆé»˜è®¤ï¼š1536x1536ï¼‰
- âœ… **è‡ªåŠ¨éªŒè¯** - è‡ªåŠ¨éªŒè¯å¹¶è°ƒæ•´è¾“å…¥å°ºå¯¸ä»¥ç¬¦åˆæ¨¡å‹è¦æ±‚
- âœ… **æ™ºèƒ½çº¦æŸ** - ç¡®ä¿å°ºå¯¸èƒ½è¢« 64 æ•´é™¤ä¸”å®½é«˜ç›¸ç­‰
- âœ… **æœ€å¤§é™åˆ¶** - æœ€å¤§æ”¯æŒ 1536x1536ï¼Œé¿å… SPN ç¼–ç å™¨è¡¥ä¸åˆ†å‰²é”™è¯¯
- âœ… **é…ç½®æ–‡ä»¶æ”¯æŒ** - é€šè¿‡ config.yaml æˆ– config.json é…ç½®è¾“å…¥å°ºå¯¸

**ğŸš€ å¼‚æ­¥ä¼˜åŒ–å‡çº§ v7.0**
- âœ… **å¼‚æ­¥ä¼˜åŒ–**ï¼Œä½¿ç”¨ ProcessPoolExecutor
- âœ… æ·»åŠ **å¥åº·æ£€æŸ¥**å’Œç»Ÿè®¡ **API ç«¯ç‚¹**
- âœ… **å¹¶å‘å¤„ç†èƒ½åŠ›**æå‡ 30-50%

**ğŸš€ æ—¥å¿—ç³»ç»Ÿå‡çº§ v6.2**
- âœ… **ä¸“ä¸šæ—¥å¿—åº“** - é›†æˆ loguru æ—¥å¿—åº“
- âœ… **ç»“æ„åŒ–æ—¥å¿—** - æ”¯æŒæ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€æ¥æºè¿½è¸ª
- âœ… **æ–‡ä»¶æ—¥å¿—** - è‡ªåŠ¨ä¿å­˜æ—¥å¿—åˆ° logs/ ç›®å½•
- âœ… **æ—¥å¿—è½®è½¬** - è‡ªåŠ¨è½®è½¬å’Œå‹ç¼©æ—¥å¿—æ–‡ä»¶
- âœ… **å½©è‰²è¾“å‡º** - æ§åˆ¶å°å½©è‰²æ—¥å¿—è¾“å‡º
- âœ… **è¯¦ç»†è¿½è¸ª** - å®Œæ•´çš„é”™è¯¯å †æ ˆè¿½è¸ª

**ğŸš€ é…ç½®æ–‡ä»¶æ”¯æŒ v6.1**
- âœ… **é…ç½®æ–‡ä»¶æ”¯æŒ** - æ”¯æŒ YAML å’Œ JSON æ ¼å¼é…ç½®æ–‡ä»¶
- âœ… **çµæ´»é…ç½®ç®¡ç†** - é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†æ‰€æœ‰åº”ç”¨è®¾ç½®
- âœ… **å‚æ•°ä¼˜å…ˆçº§** - å‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§é«˜äºé…ç½®æ–‡ä»¶
- âœ… **ç¤ºä¾‹é…ç½®æ–‡ä»¶** - æä¾› YAML å’Œ JSON æ ¼å¼çš„ç¤ºä¾‹é…ç½®

**ğŸš€ ä»£ç é‡æ„ v6.0**
- âœ… **é¢å‘å¯¹è±¡é‡æ„** - ä½¿ç”¨ç±»å’Œç®¡ç†å™¨æ¨¡å¼é‡æ–°ç»„ç»‡ä»£ç 
- âœ… **å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ** - æ”¯æŒçµæ´»çš„å¯åŠ¨é…ç½®
- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ç±»å‹æç¤ºå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- âœ… **ä»£ç è´¨é‡æå‡** - æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
- âœ… **æ€§èƒ½æ— æŸå¤±** - ä¿æŒæ‰€æœ‰åŸæœ‰åŠŸèƒ½å’Œæ€§èƒ½

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èå¯åŠ¨æ–¹å¼

#### æ™ºèƒ½è¿è¡Œï¼ˆæ¨èæ–°æ‰‹ï¼‰â­ï¼š
```bash
åŒå‡»è¿è¡Œ Start.ps1
```

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- ğŸ¯ **è‡ªåŠ¨æ£€æµ‹**: GPU ç±»å‹ï¼ˆNVIDIA/AMD/Intelï¼‰ã€ç¯å¢ƒé…ç½®ã€ä¾èµ–åº“
- ğŸ§  **æ™ºèƒ½æ¨è**: æ ¹æ®æ˜¾å¡è‡ªåŠ¨æ¨èæœ€ä½³å¯åŠ¨è„šæœ¬
- ğŸ” **å…¨é¢è¯Šæ–­**: 100+ é”™è¯¯å¤„ç†ï¼Œæ™ºèƒ½è¯†åˆ«é—®é¢˜
- ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**: æ¯ä¸ªé”™è¯¯éƒ½æä¾›è¯¦ç»†çš„è§£å†³å»ºè®®
- ğŸ“ **æ—¥å¿—è®°å½•**: æ‰€æœ‰è¿è¡Œæ—¥å¿—ä¿å­˜åœ¨ logs/ æ–‡ä»¶å¤¹
- ğŸ¨ **å½©è‰²è¾“å‡º**: æ¸…æ™°çš„è§†è§‰åé¦ˆï¼Œæ˜“äºé˜…è¯»

#### ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰ï¼š
```bash
# è‡ªåŠ¨æ£€æµ‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
python app.py

# å¼ºåˆ¶ä½¿ç”¨ GPU æ¨¡å¼
python app.py --mode gpu

# å¼ºåˆ¶ä½¿ç”¨ CPU æ¨¡å¼
python app.py --mode cpu

# è‡ªå®šä¹‰ç«¯å£
python app.py --port 8080

# ä¸è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
python app.py --no-browser
```

### è®¿é—®åœ°å€

å¯åŠ¨åè®¿é—®ï¼šhttp://127.0.0.1:8000

---

## ğŸ”§ å‘½ä»¤è¡Œå‚æ•°

### åŸºæœ¬å‚æ•°

| å‚æ•° | ç®€å†™ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `--mode` | `-m` | string | `auto` | å¯åŠ¨æ¨¡å¼ |
| `--port` | `-p` | int | `8000` | Web æœåŠ¡ç«¯å£ |
| `--host` | | string | `127.0.0.1` | Web æœåŠ¡ä¸»æœºåœ°å€ |
| `--input-size` | | int[] | `[1536, 1536]` | è¾“å…¥å›¾åƒå°ºå¯¸ [å®½åº¦, é«˜åº¦] |
| `--no-browser` | | flag | false | ä¸è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ |
| `--no-amp` | | flag | false | ç¦ç”¨æ··åˆç²¾åº¦æ¨ç†ï¼ˆAMPï¼‰ |
| `--no-cudnn-benchmark` | | flag | false | ç¦ç”¨ cuDNN Benchmark |
| `--config` | `-c` | string | - | é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒ YAML å’Œ JSONï¼‰ |

### å¯åŠ¨æ¨¡å¼ (--mode)

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| `auto` | è‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©æœ€ä½³æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ |
| `gpu` | å¼ºåˆ¶ä½¿ç”¨ GPU æ¨¡å¼ï¼ˆè‡ªåŠ¨æ£€æµ‹å‚å•†ï¼‰ |
| `cpu` | å¼ºåˆ¶ä½¿ç”¨ CPU æ¨¡å¼ |
| `nvidia` | å¼ºåˆ¶ä½¿ç”¨ NVIDIA GPU æ¨¡å¼ |
| `amd` | å¼ºåˆ¶ä½¿ç”¨ AMD GPU æ¨¡å¼ï¼ˆROCmï¼‰ |

### è¾“å…¥å°ºå¯¸ (--input-size)

è®¾ç½®æ¨ç†æ—¶ä½¿ç”¨çš„è¾“å…¥å›¾åƒå°ºå¯¸ã€‚é»˜è®¤ä¸º 1536x1536ï¼Œè¿™æ˜¯æ¨¡å‹è®­ç»ƒæ—¶ä½¿ç”¨çš„å°ºå¯¸ã€‚

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# ä½¿ç”¨é»˜è®¤å°ºå¯¸ 1536x1536
python app.py

# ä½¿ç”¨è‡ªå®šä¹‰å°ºå¯¸ 1024x1024
python app.py --input-size 1024 1024

# ä½¿ç”¨ 768x768 å¿«é€Ÿæµ‹è¯•
python app.py --input-size 768 768
```

**çº¦æŸæ¡ä»¶ï¼š**
- è¾“å…¥å°ºå¯¸å¿…é¡»èƒ½è¢« **64 æ•´é™¤**ï¼ˆæ¨¡å‹ç¼–ç å™¨ä½¿ç”¨åŸºäºè¡¥ä¸çš„åˆ†å‰²ï¼‰
- **å®½åº¦å’Œé«˜åº¦å¿…é¡»ç›¸ç­‰**ï¼ˆæ¨¡å‹ä½¿ç”¨æ­£æ–¹å½¢è¾“å…¥ï¼‰
- **æœ€å¤§æ”¯æŒå°ºå¯¸ä¸º 1536x1536**ï¼ˆSPN ç¼–ç å™¨åœ¨æ›´å¤§å°ºå¯¸ä¸‹ä¼šå‡ºç°è¡¥ä¸åˆ†å‰²é”™è¯¯ï¼‰
- å¦‚æœæä¾›çš„å°ºå¯¸ä¸ç¬¦åˆè¦æ±‚ï¼Œç¨‹åºä¼šè‡ªåŠ¨è°ƒæ•´åˆ°æœ€æ¥è¿‘çš„æœ‰æ•ˆå°ºå¯¸

**è‡ªåŠ¨è°ƒæ•´ç¤ºä¾‹ï¼š**
```bash
# 1000x1000 â†’ è‡ªåŠ¨è°ƒæ•´ä¸º 1024x1024
python app.py --input-size 1000 1000

# 1200x800 â†’ è‡ªåŠ¨è°ƒæ•´ä¸º 1200x1200ï¼ˆä¿æŒæ­£æ–¹å½¢ï¼‰
python app.py --input-size 1200 800
```

**æ¨èå°ºå¯¸ï¼š**
| å°ºå¯¸ | ç”¨é€” | æ˜¾å­˜éœ€æ±‚ | è¾“å‡ºè´¨é‡ |
|------|------|---------|---------|
| 512x512 | å¿«é€Ÿæµ‹è¯• | ä½ | åŸºç¡€ |
| 768x768 | å¹³è¡¡æ¨¡å¼ | ä¸­ç­‰ | è‰¯å¥½ |
| 1024x1024 | æ ‡å‡†æ¨¡å¼ | ä¸­ç­‰ | ä¼˜ç§€ |
| 1536x1536 | é«˜è´¨é‡ï¼ˆé»˜è®¤/æœ€å¤§ï¼‰ | é«˜ | æœ€ä½³ |

**æ³¨æ„ï¼š** æœ€å¤§æ”¯æŒå°ºå¯¸ä¸º 1536x1536ï¼Œè¶…è¿‡æ­¤å°ºå¯¸ä¼šå¯¼è‡´ SPN ç¼–ç å™¨å‡ºç°è¡¥ä¸åˆ†å‰²é”™è¯¯ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**
- è¾ƒå¤§çš„è¾“å…¥å°ºå¯¸ä¼šæé«˜æ¨¡å‹è¾“å‡ºè´¨é‡ï¼Œä½†éœ€è¦æ›´å¤šçš„æ˜¾å­˜å’Œè®¡ç®—æ—¶é—´
- è¾ƒå°çš„è¾“å…¥å°ºå¯¸å¯ä»¥åŠ å¿«æ¨ç†é€Ÿåº¦ï¼Œé™ä½æ˜¾å­˜å ç”¨ï¼Œä½†å¯èƒ½é™ä½è¾“å‡ºè´¨é‡
- æ¨èèŒƒå›´ï¼š512x512 åˆ° 1536x1536
- **æœ€å¤§æ”¯æŒå°ºå¯¸ä¸º 1536x1536**ï¼Œè¶…è¿‡æ­¤å°ºå¯¸ä¼šå¯¼è‡´è¡¥ä¸åˆ†å‰²é”™è¯¯
- å¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œå»ºè®®ä½¿ç”¨è¾ƒå°çš„å°ºå¯¸
- å¦‚æœä½¿ç”¨éæ ‡å‡†å°ºå¯¸ï¼Œç¨‹åºä¼šè‡ªåŠ¨è°ƒæ•´å¹¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯

### ä½¿ç”¨ç¤ºä¾‹

```bash
# åŸºæœ¬ä½¿ç”¨
python app.py
python app.py --mode gpu
python app.py --mode cpu

# æŒ‡å®š GPU å‚å•†
python app.py --mode nvidia
python app.py --mode amd

# è‡ªå®šä¹‰ç«¯å£å’Œä¸»æœº
python app.py --port 8080
python app.py --host 0.0.0.0 --port 8000

# è‡ªå®šä¹‰è¾“å…¥å°ºå¯¸
python app.py --input-size 1024 1024
python app.py --input-size 768 768

# ç¦ç”¨ä¼˜åŒ–é€‰é¡¹ï¼ˆè°ƒè¯•ç”¨ï¼‰
python app.py --no-browser
python app.py --no-amp
python app.py --no-cudnn-benchmark

# å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼ˆå‡å°‘æ˜¾å­˜å ç”¨ï¼‰
python app.py --gradient-checkpointing

# ç»„åˆä½¿ç”¨
python app.py --mode nvidia --port 8080 --no-browser --input-size 1024 1024
python app.py --gradient-checkpointing --input-size 1536 1536

# ä½¿ç”¨é…ç½®æ–‡ä»¶
python app.py --config config.yaml
python app.py --config config.json
python app.py -c config.yaml

# é…ç½®æ–‡ä»¶ + å‘½ä»¤è¡Œå‚æ•°ï¼ˆå‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆï¼‰
python app.py --config config.yaml --port 8080 --input-size 1024 1024
```

### è·å–å¸®åŠ©

```bash
python app.py --help
python app.py -h
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
MLSharp-3D-Maker-GPU-by-Chidc/
â”œâ”€â”€ app.py                        # ä¸»åº”ç”¨ç¨‹åºï¼ˆé‡æ„ç‰ˆæœ¬ï¼‰â­
â”œâ”€â”€ config.yaml                   # YAML æ ¼å¼é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.json                   # JSON æ ¼å¼é…ç½®æ–‡ä»¶
â”œâ”€â”€ gpu_utils.py                  # GPU å·¥å…·æ¨¡å—
â”œâ”€â”€ logger.py                     # æ—¥å¿—æ¨¡å—
â”œâ”€â”€ metrics.py                    # ç›‘æ§æŒ‡æ ‡æ¨¡å— â­
â”œâ”€â”€ optimistic.md                 # æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£ â­
â”œâ”€â”€ Start.bat                     # Windows å¯åŠ¨è„šæœ¬
â”œâ”€â”€ Start.ps1                     # PowerShell å¯åŠ¨è„šæœ¬
â”œâ”€â”€ model_assets/                 # æ¨¡å‹æ–‡ä»¶å’Œèµ„æº
â”‚   â”œâ”€â”€ sharp_2572gikvuh.pt      # SHaRP æ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ inputs/                   # è¾“å…¥ç¤ºä¾‹
â”‚   â””â”€â”€ outputs/                  # è¾“å‡ºç¤ºä¾‹
â”œâ”€â”€ python_env/                   # Python ç¯å¢ƒ
â”œâ”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶å¤¹
â”œâ”€â”€ tmp/                          # ä¸´æ—¶æ–‡ä»¶å’Œå¤‡ä»½
â”‚   â””â”€â”€ 1.28/                     # 2026-01-28 å¤‡ä»½
â””â”€â”€ temp_workspace/               # ä¸´æ—¶å·¥ä½œç›®å½•
```

---

## ğŸ”§ å‘½ä»¤è¡Œå‚æ•°

### åŸºæœ¬å‚æ•°

| å‚æ•° | ç®€å†™ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `--mode` | `-m` | string | `auto` | å¯åŠ¨æ¨¡å¼ |
| `--port` | `-p` | int | `8000` | Web æœåŠ¡ç«¯å£ |
| `--host` | | string | `127.0.0.1` | Web æœåŠ¡ä¸»æœºåœ°å€ |
| `--input-size` | | int[] | `[1536, 1536]` | è¾“å…¥å›¾åƒå°ºå¯¸ [å®½åº¦, é«˜åº¦] |
| `--no-browser` | | flag | false | ä¸è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ |
| `--no-amp` | | flag | false | ç¦ç”¨æ··åˆç²¾åº¦æ¨ç†ï¼ˆAMPï¼‰ |
| `--no-cudnn-benchmark` | | flag | false | ç¦ç”¨ cuDNN Benchmark |
| `--config` | `-c` | string | - | é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒ YAML å’Œ JSONï¼‰ |

### å¯åŠ¨æ¨¡å¼ (--mode)

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| `auto` | è‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©æœ€ä½³æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ |
| `gpu` | å¼ºåˆ¶ä½¿ç”¨ GPU æ¨¡å¼ï¼ˆè‡ªåŠ¨æ£€æµ‹å‚å•†ï¼‰ |
| `cpu` | å¼ºåˆ¶ä½¿ç”¨ CPU æ¨¡å¼ |
| `nvidia` | å¼ºåˆ¶ä½¿ç”¨ NVIDIA GPU æ¨¡å¼ |
| `amd` | å¼ºåˆ¶ä½¿ç”¨ AMD GPU æ¨¡å¼ï¼ˆROCmï¼‰ |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# åŸºæœ¬ä½¿ç”¨
python app.py
python app.py --mode gpu
python app.py --mode cpu

# æŒ‡å®š GPU å‚å•†
python app.py --mode nvidia
python app.py --mode amd

# è‡ªå®šä¹‰ç«¯å£å’Œä¸»æœº
python app.py --port 8080
python app.py --host 0.0.0.0 --port 8000

# ç¦ç”¨ä¼˜åŒ–é€‰é¡¹ï¼ˆè°ƒè¯•ç”¨ï¼‰
python app.py --no-browser
python app.py --no-amp
python app.py --no-cudnn-benchmark

# ç»„åˆä½¿ç”¨
python app.py --mode nvidia --port 8080 --no-browser --input-size 1024 1024

# ä½¿ç”¨é…ç½®æ–‡ä»¶
python app.py --config config.yaml
python app.py --config config.json
python app.py -c config.yaml

# é…ç½®æ–‡ä»¶ + å‘½ä»¤è¡Œå‚æ•°ï¼ˆå‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆï¼‰
python app.py --config config.yaml --port 8080 --input-size 1024 1024
```

### è·å–å¸®åŠ©

```bash
python app.py --help
python app.py -h
```

---

## ğŸ“Š GPU æ”¯æŒæƒ…å†µ

### NVIDIA GPU
| æ¶æ„ | æ˜¾å¡ç³»åˆ— | è®¡ç®—èƒ½åŠ› | æ”¯æŒçŠ¶æ€ | ä¼˜åŒ– |
|------|---------|---------|---------|------|
| Ampere | RTX 30/40 ç³»åˆ— | 8.0+ | âœ… å®Œå…¨æ”¯æŒ | AMP, TF32, cuDNN |
| Turing | RTX 20 ç³»åˆ— | 7.5 | âœ… å®Œå…¨æ”¯æŒ | AMP, cuDNN |
| Pascal | GTX 10/16 ç³»åˆ— | 6.1 | âœ… å®Œå…¨æ”¯æŒ | AMP, cuDNN |
| Maxwell | GTX 9xx ç³»åˆ— | 5.2 | âœ… æ”¯æŒ | AMP |
| Kepler | GTX 7xx ç³»åˆ— | 3.0-3.7 | âš ï¸ è€æ—§ GPU | åŸºç¡€ |
| Fermi | GTX 6xx ç³»åˆ— | 2.1 | âŒ ä¸æ¨è | - |

### AMD GPU
| æ¶æ„ | æ˜¾å¡ç³»åˆ— | ROCm æ”¯æŒ | æ”¯æŒçŠ¶æ€ |
|------|---------|----------|---------|
| RDNA 2 | RX 6000 ç³»åˆ— | âœ… | âœ… å®Œå…¨æ”¯æŒ |
| RDNA 1 | RX 5000 ç³»åˆ— | âœ… | âœ… å®Œå…¨æ”¯æŒ |
| GCN 5 | Vega ç³»åˆ— | âœ… | âœ… æ”¯æŒ |
| GCN 4 | RX 400/500 ç³»åˆ— | âš ï¸ | âš ï¸ éƒ¨åˆ†æ”¯æŒ |
| GCN 3 | RX 300 ç³»åˆ— | âŒ | âŒ ä¸æ”¯æŒ |

### Intel GPU
| æ¶æ„ | æ˜¾å¡ç³»åˆ— | æ”¯æŒçŠ¶æ€ |
|------|---------|---------|
| Xe | Arc ç³»åˆ— | âš ï¸ ä»… CPU æ¨¡å¼ |
| Iris Xe | é›†æˆæ˜¾å¡ | âš ï¸ ä»… CPU æ¨¡å¼ |
| UHD | é›†æˆæ˜¾å¡ | âš ï¸ ä»… CPU æ¨¡å¼ |

---

## ğŸ“Š æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—ç‰¹æ€§

MLSharp ä½¿ç”¨ Loguru ä½œä¸ºæ—¥å¿—ç³»ç»Ÿï¼Œæä¾›ä¸“ä¸šçš„æ—¥å¿—ç®¡ç†åŠŸèƒ½ï¼š

- **ç»“æ„åŒ–æ—¥å¿—**: åŒ…å«æ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€æ¥æºä¿¡æ¯
- **å½©è‰²è¾“å‡º**: æ§åˆ¶å°å½©è‰²æ˜¾ç¤ºï¼Œæ˜“äºåŒºåˆ†ä¸åŒçº§åˆ«
- **æ–‡ä»¶æ—¥å¿—**: è‡ªåŠ¨ä¿å­˜åˆ° `logs/` ç›®å½•
- **æ—¥å¿—è½®è½¬**: è‡ªåŠ¨è½®è½¬å’Œå‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼ˆ10MB è½®è½¬ï¼Œä¿ç•™7å¤©ï¼‰
- **é”™è¯¯è¿½è¸ª**: å®Œæ•´çš„é”™è¯¯å †æ ˆè¿½è¸ªå’Œè¯Šæ–­ä¿¡æ¯
- **å¤šçº§åˆ«**: DEBUG, INFO, WARNING, ERROR, CRITICAL

### æ—¥å¿—æ–‡ä»¶

æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `logs/` ç›®å½•ï¼š
- æ–‡ä»¶å‘½åï¼š`mlsharp_YYYYMMDD.log`
- å‹ç¼©æ–‡ä»¶ï¼š`mlsharp_YYYYMMDD.log.zip`
- ä¿ç•™æ—¶é—´ï¼š7å¤©

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| DEBUG | è°ƒè¯•ä¿¡æ¯ | å˜é‡å€¼ã€å‡½æ•°è°ƒç”¨ |
| INFO | ä¸€èˆ¬ä¿¡æ¯ | å¯åŠ¨ä¿¡æ¯ã€å¤„ç†è¿›åº¦ |
| WARNING | è­¦å‘Šä¿¡æ¯ | æ€§èƒ½è­¦å‘Šã€å…¼å®¹æ€§é—®é¢˜ |
| ERROR | é”™è¯¯ä¿¡æ¯ | å¤„ç†å¤±è´¥ã€å¼‚å¸¸ |
| CRITICAL | ä¸¥é‡é”™è¯¯ | ç³»ç»Ÿå´©æºƒã€è‡´å‘½é”™è¯¯ |

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

```
2026-01-28 20:00:00 | INFO     | MLSharp:run:10 - æœåŠ¡å¯åŠ¨
2026-01-28 20:00:01 | SUCCESS  | MLSharp:load_model:50 - æ¨¡å‹åŠ è½½å®Œæˆ
2026-01-28 20:00:02 | WARNING  | MLSharp:detect_gpu:30 - æ˜¾å­˜ä¸è¶³ 4GB
2026-01-28 20:00:03 | ERROR    | MLSharp:predict:100 | å¤„ç†å¤±è´¥: æ˜¾å­˜æº¢å‡º
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
type logs\mlsharp_20260128.log

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
dir logs\

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
findstr /C:"ERROR" logs\mlsharp_*.log
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶ä½¿ç”¨

### é…ç½®æ–‡ä»¶æ ¼å¼

æ”¯æŒ YAML å’Œ JSON ä¸¤ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚

#### YAML æ ¼å¼ (config.yaml)

```yaml
# æœåŠ¡é…ç½®
server:
  host: "127.0.0.1"        # æœåŠ¡ä¸»æœºåœ°å€
  port: 8000               # æœåŠ¡ç«¯å£

# å¯åŠ¨æ¨¡å¼
mode: "auto"               # å¯åŠ¨æ¨¡å¼: auto, gpu, cpu, nvidia, amd

# æµè§ˆå™¨é…ç½®
browser:
  auto_open: true          # è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨

# GPU ä¼˜åŒ–é…ç½®
gpu:
  enable_amp: true         # å¯ç”¨æ··åˆç²¾åº¦æ¨ç† (AMP)
  enable_cudnn_benchmark: true  # å¯ç”¨ cuDNN Benchmark
  enable_tf32: true        # å¯ç”¨ TensorFloat32

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"            # æ—¥å¿—çº§åˆ«: DEBUG, INFO, WARNING, ERROR
  console: true            # æ§åˆ¶å°è¾“å‡º
  file: false              # æ–‡ä»¶è¾“å‡º

# æ¨¡å‹é…ç½®
model:
  checkpoint: "model_assets/sharp_2572gikvuh.pt"  # æ¨¡å‹æƒé‡è·¯å¾„
  temp_dir: "temp_workspace"                     # ä¸´æ—¶å·¥ä½œç›®å½•

# æ¨ç†é…ç½®
inference:
  input_size: [1536, 1536]  # è¾“å…¥å›¾åƒå°ºå¯¸ [å®½åº¦, é«˜åº¦] (é»˜è®¤: 1536x1536)

# æ€§èƒ½é…ç½®
performance:
  max_workers: 4           # æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°
  max_concurrency: 10      # æœ€å¤§å¹¶å‘æ•°
  timeout_keep_alive: 30   # ä¿æŒè¿æ¥è¶…æ—¶(ç§’)
  max_requests: 1000       # æœ€å¤§è¯·æ±‚æ•°
```

#### JSON æ ¼å¼ (config.json)

```json
{
  "server": {
    "host": "127.0.0.1",
    "port": 8000
  },
  "mode": "auto",
  "browser": {
    "auto_open": true
  },
  "gpu": {
    "enable_amp": true,
    "enable_cudnn_benchmark": true,
    "enable_tf32": true
  },
  "logging": {
    "level": "INFO",
    "console": true,
    "file": false
  },
  "model": {
    "checkpoint": "model_assets/sharp_2572gikvuh.pt",
    "temp_dir": "temp_workspace"
  },
  "inference": {
    "input_size": [1536, 1536]
  },
  "monitoring": {
    "enabled": true,
    "enable_gpu": true,
    "metrics_path": "/metrics"
  },
  "performance": {
    "max_workers": 4,
    "max_concurrency": 10,
    "timeout_keep_alive": 30,
    "max_requests": 1000
  }
}
```

### ä½¿ç”¨é…ç½®æ–‡ä»¶

**åŸºæœ¬ä½¿ç”¨ï¼š**
```bash
# ä½¿ç”¨ YAML é…ç½®æ–‡ä»¶
python app.py --config config.yaml

# ä½¿ç”¨ JSON é…ç½®æ–‡ä»¶
python app.py --config config.json

# ç®€å†™
python app.py -c config.yaml
```

**é…ç½®æ–‡ä»¶ + å‘½ä»¤è¡Œå‚æ•°ï¼š**
```bash
# å‘½ä»¤è¡Œå‚æ•°ä¼šè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„å¯¹åº”è®¾ç½®
python app.py --config config.yaml --port 8080 --mode gpu
```

### å‚æ•°ä¼˜å…ˆçº§

å‘½ä»¤è¡Œå‚æ•° > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼

ä¾‹å¦‚ï¼š
```bash
# config.yaml ä¸­è®¾ç½® port: 8000
# å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š --port 8080
# æœ€ç»ˆä½¿ç”¨ 8080
python app.py --config config.yaml --port 8080
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ | å¯é€‰å€¼ |
|--------|------|--------|
| `server.host` | æœåŠ¡ä¸»æœºåœ°å€ | IP åœ°å€ |
| `server.port` | æœåŠ¡ç«¯å£ | 1-65535 |
| `mode` | å¯åŠ¨æ¨¡å¼ | auto, gpu, cpu, nvidia, amd |
| `browser.auto_open` | è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ | true, false |
| `gpu.enable_amp` | å¯ç”¨æ··åˆç²¾åº¦æ¨ç† | true, false |
| `gpu.enable_cudnn_benchmark` | å¯ç”¨ cuDNN Benchmark | true, false |
| `gpu.enable_tf32` | å¯ç”¨ TensorFloat32 | true, false |
| `logging.level` | æ—¥å¿—çº§åˆ« | DEBUG, INFO, WARNING, ERROR |
| `logging.console` | æ§åˆ¶å°è¾“å‡º | true, false |
| `logging.file` | æ–‡ä»¶è¾“å‡º | true, false |
| `model.checkpoint` | æ¨¡å‹æƒé‡è·¯å¾„ | æ–‡ä»¶è·¯å¾„ |
| `model.temp_dir` | ä¸´æ—¶å·¥ä½œç›®å½• | ç›®å½•è·¯å¾„ |
| `inference.input_size` | è¾“å…¥å›¾åƒå°ºå¯¸ | [å®½åº¦, é«˜åº¦]ï¼Œé»˜è®¤ [1536, 1536] |
| `monitoring.enabled` | å¯ç”¨ç›‘æ§ | true, false |
| `monitoring.enable_gpu` | å¯ç”¨ GPU ç›‘æ§ | true, false |
| `monitoring.metrics_path` | Prometheus æŒ‡æ ‡ç«¯ç‚¹è·¯å¾„ | è·¯å¾„å­—ç¬¦ä¸² |
| `optimization.gradient_checkpointing` | å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ | true, false |
| `optimization.checkpoint_segments` | æ¢¯åº¦æ£€æŸ¥ç‚¹åˆ†æ®µæ•° | æ­£æ•´æ•° |
| `performance.max_workers` | æœ€å¤§å·¥ä½œçº¿ç¨‹æ•° | æ­£æ•´æ•° |
| `performance.max_concurrency` | æœ€å¤§å¹¶å‘æ•° | æ­£æ•´æ•° |
| `performance.timeout_keep_alive` | ä¿æŒè¿æ¥è¶…æ—¶(ç§’) | æ­£æ•´æ•° |
| `performance.max_requests` | æœ€å¤§è¯·æ±‚æ•° | æ­£æ•´æ•° |

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜ 1: å¯åŠ¨å¤±è´¥
**ç—‡çŠ¶**: åŒå‡»å¯åŠ¨è„šæœ¬åé—ªé€€æˆ–æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Python ç¯å¢ƒæ˜¯å¦å®Œæ•´
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/` ä¸­çš„é”™è¯¯ä¿¡æ¯
3. ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š`python app.py --no-browser`

### é—®é¢˜ 2: GPU æ£€æµ‹ä¸åˆ°
**ç—‡çŠ¶**: æç¤ºä½¿ç”¨ CPU æ¨¡å¼ï¼Œä½†å®é™…æœ‰ GPU

**è§£å†³æ–¹æ¡ˆ**:
1. NVIDIA ç”¨æˆ·æ£€æŸ¥æ˜¾å¡é©±åŠ¨å’Œ CUDA
2. AMD ç”¨æˆ·æ£€æŸ¥ ROCm é©±åŠ¨
3. æ£€æŸ¥æ˜¾å¡æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
4. ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å¼ºåˆ¶æŒ‡å®šï¼š`python app.py --mode nvidia`

### é—®é¢˜ 3: GPU å‚å•†æ£€æµ‹é”™è¯¯
**ç—‡çŠ¶**: NVIDIA GPU è¢«è¯¯è¯†åˆ«ä¸º AMD æˆ– Intel

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å¼ºåˆ¶æŒ‡å®šæ¨¡å¼ï¼š`python app.py --mode nvidia`
2. æ‰‹åŠ¨é€‰æ‹©å¯¹åº”çš„å¯åŠ¨è„šæœ¬

### é—®é¢˜ 4: å†…å­˜ä¸è¶³
**ç—‡çŠ¶**: æç¤ºæ˜¾å­˜ä¸è¶³æˆ–ç¨‹åºå´©æºƒ

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨è¾ƒå°çš„è¾“å…¥å›¾ç‰‡ï¼ˆå»ºè®® < 1024x1024ï¼‰
2. å…³é—­å…¶ä»–å ç”¨æ˜¾å­˜çš„ç¨‹åº
3. ä½¿ç”¨ CPU æ¨¡å¼ï¼š`python app.py --mode cpu`
4. ç¦ç”¨æ··åˆç²¾åº¦ï¼š`python app.py --no-amp`
5. å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼š`python app.py --gradient-checkpointing`ï¼ˆå‡å°‘ 30-50% æ˜¾å­˜ï¼‰

### é—®é¢˜ 5: æ¨ç†é€Ÿåº¦æ…¢
**ç—‡çŠ¶**: æ¨ç†æ—¶é—´è¿‡é•¿

**å¯èƒ½åŸå› **:
- ä½¿ç”¨ CPU æ¨¡å¼
- è€æ—§ GPU
- æ˜¾å­˜ä¸è¶³
- å›¾ç‰‡è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ GPU æ¨¡å¼ï¼ˆå¦‚æœå¯ç”¨ï¼‰
2. ä½¿ç”¨æ›´å¿«çš„å¯åŠ¨è„šæœ¬
3. ç¼©å°è¾“å…¥å›¾ç‰‡å°ºå¯¸
4. å‡çº§ç¡¬ä»¶

### é—®é¢˜ 6: ç«¯å£è¢«å ç”¨
**ç—‡çŠ¶**: å¯åŠ¨æ—¶æŠ¥é”™ç«¯å£å·²è¢«ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š`python app.py --port 8080`
2. å…³é—­å ç”¨ 8000 ç«¯å£çš„ç¨‹åº
3. ä½¿ç”¨å‘½ä»¤æŸ¥æ‰¾å¹¶å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

MLSharp æä¾›äº†å®Œæ•´çš„ Prometheus å…¼å®¹ç›‘æ§æŒ‡æ ‡ï¼Œå¯ç”¨äºæ€§èƒ½ç›‘æ§å’Œé—®é¢˜è¯Šæ–­ã€‚

### å¯ç”¨ç›‘æ§

ç›‘æ§åŠŸèƒ½é»˜è®¤å¯ç”¨ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ï¼š

```yaml
# config.yaml
monitoring:
  enabled: true             # å¯ç”¨ç›‘æ§
  enable_gpu: true          # å¯ç”¨ GPU ç›‘æ§
  metrics_path: "/metrics"  # Prometheus æŒ‡æ ‡ç«¯ç‚¹è·¯å¾„
```

### è®¿é—®æŒ‡æ ‡

å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ç›‘æ§æŒ‡æ ‡ï¼š

```bash
# è®¿é—® Prometheus æŒ‡æ ‡ç«¯ç‚¹
curl http://127.0.0.1:8000/metrics
```

### ç›‘æ§æŒ‡æ ‡è¯´æ˜

#### HTTP è¯·æ±‚æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `http_requests_total` | Counter | HTTP è¯·æ±‚æ€»æ•° |
| `http_request_duration_seconds` | Histogram | HTTP è¯·æ±‚å“åº”æ—¶é—´ |

**æ ‡ç­¾**:
- `method`: HTTP æ–¹æ³•ï¼ˆGET, POST ç­‰ï¼‰
- `endpoint`: ç«¯ç‚¹è·¯å¾„
- `status`: HTTP çŠ¶æ€ç 

#### é¢„æµ‹è¯·æ±‚æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `predict_requests_total` | Counter | é¢„æµ‹è¯·æ±‚æ€»æ•° |
| `predict_duration_seconds` | Histogram | é¢„æµ‹è¯·æ±‚æ€»è€—æ—¶ |
| `predict_stage_duration_seconds` | Histogram | é¢„æµ‹å„é˜¶æ®µè€—æ—¶ |

**æ ‡ç­¾**:
- `status`: è¯·æ±‚çŠ¶æ€ï¼ˆsuccess/errorï¼‰
- `stage`: é˜¶æ®µåç§°ï¼ˆimage_load, inference, ply_save, totalï¼‰

#### GPU ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `gpu_memory_used_mb` | Gauge | GPU å†…å­˜ä½¿ç”¨é‡ï¼ˆMBï¼‰ |
| `gpu_utilization_percent` | Gauge | GPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯” |
| `gpu_info` | Gauge | GPU ä¿¡æ¯ |

**æ ‡ç­¾**:
- `device_id`: è®¾å¤‡ ID
- `name`: GPU åç§°
- `vendor`: å‚å•†åç§°

#### ç³»ç»ŸæŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `active_tasks` | Gauge | å½“å‰æ´»è·ƒä»»åŠ¡æ•° |
| `app_info` | Info | åº”ç”¨ä¿¡æ¯ |
| `input_size_info` | Gauge | è¾“å…¥å›¾åƒå°ºå¯¸ |

### Prometheus é›†æˆ

#### å®‰è£… Prometheus

```bash
# ä¸‹è½½ Prometheus
wget https://github.com/prometheus/prometheus/releases/download/v2.47.0/prometheus-2.47.0.linux-amd64.tar.gz
tar xvfz prometheus-2.47.0.linux-amd64.tar.gz
cd prometheus-2.47.0.linux-amd64

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > prometheus.yml << EOF
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'mlsharp'
    static_configs:
      - targets: ['localhost:8000']
EOF

# å¯åŠ¨ Prometheus
./prometheus
```

è®¿é—® Prometheus UI: http://localhost:9090

#### ä½¿ç”¨ Grafana å¯è§†åŒ–

1. å®‰è£… Grafana
2. æ·»åŠ  Prometheus æ•°æ®æº
3. åˆ›å»ºä»ªè¡¨æ¿

**æ¨èä»ªè¡¨æ¿é…ç½®**:

- HTTP è¯·æ±‚é€Ÿç‡: `rate(http_requests_total[5m])`
- é¢„æµ‹è¯·æ±‚é€Ÿç‡: `rate(predict_requests_total[5m])`
- å¹³å‡å“åº”æ—¶é—´: `rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])`
- GPU å†…å­˜ä½¿ç”¨: `gpu_memory_used_mb`
- GPU åˆ©ç”¨ç‡: `gpu_utilization_percent`
- æ´»è·ƒä»»åŠ¡æ•°: `active_tasks`

### æ€§èƒ½ç›‘æ§ç¤ºä¾‹

#### æŸ¥çœ‹è¯·æ±‚é€Ÿç‡

```bash
# æŸ¥çœ‹æœ€è¿‘ 5 åˆ†é’Ÿçš„è¯·æ±‚é€Ÿç‡
curl 'http://localhost:9090/api/v1/query?query=rate(http_requests_total[5m])'
```

#### æŸ¥çœ‹å¹³å‡å“åº”æ—¶é—´

```bash
# æŸ¥çœ‹æœ€è¿‘ 5 åˆ†é’Ÿçš„å¹³å‡å“åº”æ—¶é—´
curl 'http://localhost:9090/api/v1/query?query=rate(http_request_duration_seconds_sum[5m])%20%2F%20rate(http_request_duration_seconds_count[5m])'
```

#### æŸ¥çœ‹ GPU ä½¿ç”¨æƒ…å†µ

```bash
# æŸ¥çœ‹ GPU å†…å­˜ä½¿ç”¨
curl 'http://localhost:9090/api/v1/query?query=gpu_memory_used_mb'

# æŸ¥çœ‹ GPU åˆ©ç”¨ç‡
curl 'http://localhost:9090/api/v1/query?query=gpu_utilization_percent'
```

### ç›‘æ§æœ€ä½³å®è·µ

1. **è®¾ç½®å‘Šè­¦è§„åˆ™**
   - è¯·æ±‚é”™è¯¯ç‡è¶…è¿‡ 5%
   - å¹³å‡å“åº”æ—¶é—´è¶…è¿‡ 60 ç§’
   - GPU å†…å­˜ä½¿ç”¨è¶…è¿‡ 90%
   - GPU åˆ©ç”¨ç‡è¶…è¿‡ 95%

2. **å®šæœŸæ£€æŸ¥æŒ‡æ ‡**
   - æ¯å¤©æŸ¥çœ‹è¯·æ±‚é‡å’Œå“åº”æ—¶é—´è¶‹åŠ¿
   - ç›‘æ§ GPU èµ„æºä½¿ç”¨æƒ…å†µ
   - åˆ†æé”™è¯¯æ—¥å¿—å’Œå¤±è´¥è¯·æ±‚

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ ¹æ®å“åº”æ—¶é—´è°ƒæ•´è¾“å…¥å°ºå¯¸
   - æ ¹æ® GPU ä½¿ç”¨æƒ…å†µä¼˜åŒ–å¹¶å‘æ•°
   - æ ¹æ®é”™è¯¯ç‡ä¼˜åŒ–æ¨¡å‹é…ç½®
   - æ˜¾å­˜ä¸è¶³æ—¶å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼ˆ--gradient-checkpointingï¼‰

---

## ğŸ“ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI + Uvicorn
- **æ·±åº¦å­¦ä¹ **: PyTorch + Apple SHaRP æ¨¡å‹
- **3D æ¸²æŸ“**: 3D Gaussian Splatting
- **GPU åŠ é€Ÿ**: CUDA (NVIDIA) / ROCm (AMD)
- **CPU ä¼˜åŒ–**: OpenMP / MKL
- **æ—¥å¿—ç³»ç»Ÿ**: Loguru
- **ç›‘æ§æŒ‡æ ‡**: Prometheus + Prometheus Client
- **æ¶æ„è®¾è®¡**: é¢å‘å¯¹è±¡ + ç®¡ç†å™¨æ¨¡å¼

---

## ğŸ”¬ ä»£ç æ¶æ„ï¼ˆé‡æ„åï¼‰

### æ ¸å¿ƒç±»

#### 1. é…ç½®ç±»
- **AppConfig**: åº”ç”¨é…ç½®ç®¡ç†
- **GPUConfig**: GPU é…ç½®å’ŒçŠ¶æ€
- **CLIArgs**: å‘½ä»¤è¡Œå‚æ•°è§£æ

#### 2. å·¥å…·ç±»
- **Logger**: ç»Ÿä¸€æ—¥å¿—è¾“å‡º

#### 3. ç®¡ç†å™¨ç±»
- **GPUManager**: GPU æ£€æµ‹ã€åˆå§‹åŒ–å’Œä¼˜åŒ–é…ç½®
- **ModelManager**: æ¨¡å‹åŠ è½½å’Œæ¨ç†ç®¡ç†
- **MetricsManager**: ç›‘æ§æŒ‡æ ‡æ”¶é›†å’Œç®¡ç†

#### 4. åº”ç”¨ä¸»ç±»
- **MLSharpApp**: åº”ç”¨ä¸»å…¥å£å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

### ä»£ç è´¨é‡æ”¹è¿›

| æ–¹é¢ | æ”¹è¿› |
|------|------|
| ä»£ç è¡Œæ•° | å‡å°‘ 17%ï¼ˆ965 â†’ ~800 è¡Œï¼‰ |
| ç±»å‹æç¤º | å®Œæ•´è¦†ç›– |
| æ–‡æ¡£å­—ç¬¦ä¸² | æ‰€æœ‰ç±»å’Œæ–¹æ³• |
| ä»£ç å¤ç”¨ | æ¶ˆé™¤é‡å¤ |
| å¯æµ‹è¯•æ€§ | ç»„ä»¶ç‹¬ç«‹ |
| å¯ç»´æŠ¤æ€§ | æ˜¾è‘—æå‡ |

### æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | å˜åŒ– |
|------|--------|--------|------|
| å¯åŠ¨æ—¶é—´ | ~5-10ç§’ | ~5-10ç§’ | æ— å˜åŒ– |
| é¦–æ¬¡æ¨ç† | ~30-40ç§’ | ~30-40ç§’ | æ— å˜åŒ– |
| åç»­æ¨ç† | ~15-20ç§’ | ~15-20ç§’ | æ— å˜åŒ– |
| å†…å­˜å ç”¨ | ~2-4GB | ~2-4GB | æ— å˜åŒ– |

---

## ğŸ“š ç‰ˆæœ¬å†å²

### v7.3 (2026-01-29)
- æ¢¯åº¦æ£€æŸ¥ç‚¹åŠŸèƒ½ï¼Œå‡å°‘æ˜¾å­˜å ç”¨ 30-50%
- æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶æ§åˆ¶
- æ·»åŠ æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£ï¼ˆoptimistic.mdï¼‰
- å®Œå–„æ•…éšœæ’é™¤æ–‡æ¡£

### v7.2 (2026-01-29)
- ç›‘æ§æŒ‡æ ‡ç³»ç»Ÿ - Prometheus é›†æˆ
- æ€§èƒ½ç›‘æ§ - HTTP è¯·æ±‚ã€é¢„æµ‹è¯·æ±‚ã€å“åº”æ—¶é—´ç»Ÿè®¡
- GPU ç›‘æ§ - å®æ—¶ GPU å†…å­˜ä½¿ç”¨é‡å’Œåˆ©ç”¨ç‡ç›‘æ§
- ä»»åŠ¡è¿½è¸ª - æ´»è·ƒä»»åŠ¡æ•°å’Œå„é˜¶æ®µè€—æ—¶ç»Ÿè®¡
- é…ç½®æ”¯æŒ - é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ç›‘æ§åŠŸèƒ½

### v7.1 (2026-01-29)
- è¾“å…¥å°ºå¯¸å‚æ•° - æ”¯æŒè‡ªå®šä¹‰æ¨ç†è¾“å…¥å°ºå¯¸
- è‡ªåŠ¨éªŒè¯ - è‡ªåŠ¨éªŒè¯å¹¶è°ƒæ•´è¾“å…¥å°ºå¯¸ä»¥ç¬¦åˆæ¨¡å‹è¦æ±‚
- æ™ºèƒ½çº¦æŸ - ç¡®ä¿å°ºå¯¸èƒ½è¢« 64 æ•´é™¤ä¸”å®½é«˜ç›¸ç­‰
- æœ€å¤§é™åˆ¶ - æœ€å¤§æ”¯æŒ 1536x1536ï¼Œé¿å… SPN ç¼–ç å™¨è¡¥ä¸åˆ†å‰²é”™è¯¯
- é…ç½®æ–‡ä»¶æ”¯æŒ - é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®è¾“å…¥å°ºå¯¸

### v7.0 (2026-01-28)
- å¼‚æ­¥ä¼˜åŒ–ï¼Œä½¿ç”¨ ProcessPoolExecutor
- æ·»åŠ å¥åº·æ£€æŸ¥å’Œç»Ÿè®¡ API ç«¯ç‚¹
- å¹¶å‘å¤„ç†èƒ½åŠ›æå‡ 30-50%
- ä¿®å¤ GPU å‚å•†æ£€æµ‹é€»è¾‘

### v6.2 (2026-01-28)
- é›†æˆ loguru ä¸“ä¸šæ—¥å¿—åº“
- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨è½®è½¬å’Œå‹ç¼©
- å½©è‰²æ§åˆ¶å°è¾“å‡º

### v6.1 (2026-01-28)
- æ·»åŠ é…ç½®æ–‡ä»¶æ”¯æŒï¼ˆYAML/JSONï¼‰
- é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°åˆå¹¶
- æä¾›ç¤ºä¾‹é…ç½®æ–‡ä»¶

### v6.0 (2026-01-28)
- ä»£ç é‡æ„ï¼Œé‡‡ç”¨é¢å‘å¯¹è±¡è®¾è®¡
- æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
- å®Œæ•´çš„ç±»å‹æç¤ºå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§

### v5.0 (2026-01-24)
- å…¨é¢å…¼å®¹æ€§å‡çº§
- æ”¯æŒ NVIDIAã€AMDã€Intel æ˜¾å¡
- è€æ—§ GPU æ”¯æŒ
- Windows 11 å…¼å®¹

### v4.0 (2026-01-17)
- æ™ºèƒ½è‡ªåŠ¨è¯Šæ–­ç¨‹åº
- GPU å…¼å®¹æ€§ä¿®å¤
- æ—¥å¿—ç³»ç»Ÿ
- Unicode ç¼–ç ä¿®å¤

### v3.0
- GPU æ··åˆç²¾åº¦æ¨ç†ï¼ˆAMPï¼‰
- cuDNN Benchmark è‡ªåŠ¨ä¼˜åŒ–
- TensorFloat32 çŸ©é˜µä¹˜æ³•åŠ é€Ÿ
- CPU å¤šçº¿ç¨‹ä¼˜åŒ–

---

## ğŸ› å½“å‰å·²çŸ¥é—®é¢˜

### é—®é¢˜ 1: CUDA ä¸å¯ç”¨ï¼ˆIntel é›†æ˜¾ + NVIDIA ç‹¬æ˜¾ï¼‰
**ç—‡çŠ¶**: ç³»ç»Ÿæ£€æµ‹åˆ° NVIDIA æ˜¾å¡ä½†æç¤º CUDA ä¸å¯ç”¨
**åŸå› **: PyTorch å¯èƒ½æœªç¼–è¯‘ CUDA æ”¯æŒæˆ–é©±åŠ¨æœªæ­£ç¡®å®‰è£…
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ CUDA æ˜¯å¦å¯ç”¨
python -c "import torch; print(torch.cuda.is_available())"

# å¦‚æœè¿”å› Falseï¼Œé‡æ–°å®‰è£…å¸¦ CUDA çš„ PyTorch
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu121
```

### é—®é¢˜ 2: ProcessPoolExecutor å†…å­˜å ç”¨è¾ƒé«˜
**ç—‡çŠ¶**: å¤šä¸ªå¹¶å‘è¯·æ±‚æ—¶å†…å­˜å ç”¨å¢é•¿è¾ƒå¿«
**åŸå› **: è¿›ç¨‹æ± ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ›å»ºç‹¬ç«‹çš„å†…å­˜ç©ºé—´
**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘è¿›ç¨‹æ± å¤§å°ï¼š`max_workers=2`
- æˆ–å›é€€åˆ°çº¿ç¨‹æ± ï¼šæ”¹ç”¨ `ThreadPoolExecutor`

### é—®é¢˜ 3: æ—¥å¿—æ–‡ä»¶å¯èƒ½è¿‡å¤§
**ç—‡çŠ¶**: logs/ ç›®å½•å ç”¨å¤§é‡ç£ç›˜ç©ºé—´
**åŸå› **: loguru é»˜è®¤ä¸é™åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°
**è§£å†³æ–¹æ¡ˆ**:
- å®šæœŸæ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- æˆ–åœ¨é…ç½®ä¸­å¯ç”¨æ—¥å¿—å‹ç¼©

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### GPU æ¨¡å¼ä¼˜åŒ–
1. **ä½¿ç”¨åˆé€‚çš„å›¾ç‰‡å°ºå¯¸**
   - æ¨è: 512x512 - 1024x1024
   - é¿å…è¶…è¿‡ 2048x2048

2. **å¯ç”¨æ‰€æœ‰ä¼˜åŒ–**
   - AMPï¼ˆæ··åˆç²¾åº¦ï¼‰å·²é»˜è®¤å¯ç”¨
   - cuDNN Benchmark å·²é»˜è®¤å¯ç”¨
   - TF32 å·²é»˜è®¤å¯ç”¨ï¼ˆAmpere æ¶æ„ï¼‰

3. **æ˜¾å­˜ä¸è¶³æ—¶å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹**
   - ä½¿ç”¨ `--gradient-checkpointing` å‚æ•°
   - å¯å‡å°‘ 30-50% æ˜¾å­˜å ç”¨
   - é€Ÿåº¦ç•¥å¾®é™ä½ 10-20%ï¼ˆå¯æ¥å—ï¼‰

4. **å…³é—­å…¶ä»– GPU å ç”¨ç¨‹åº**
   - å…³é—­æµè§ˆå™¨ç¡¬ä»¶åŠ é€Ÿ
   - å…³é—­å…¶ä»– AI åº”ç”¨
   - å…³é—­æ¸¸æˆæˆ–å›¾å½¢å¯†é›†å‹åº”ç”¨

### CPU æ¨¡å¼ä¼˜åŒ–
1. **ä½¿ç”¨æ›´å°çš„å›¾ç‰‡**
   - æ¨è: 512x512 æˆ–æ›´å°

2. **å‡å°‘å¹¶å‘æ•°**
   - ä¿®æ”¹é…ç½®ä¸­çš„ `max_workers`
   - æ¨èå€¼: CPU æ ¸å¿ƒæ•° / 2

3. **ä½¿ç”¨æ›´å¿«çš„å¯åŠ¨è„šæœ¬**
   - `Start_CPU_Fast.bat` - å¿«é€Ÿæ¨¡å¼

### ç³»ç»Ÿçº§ä¼˜åŒ–
1. **å¢åŠ è™šæ‹Ÿå†…å­˜**
   - è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 1.5-2 å€

2. **ä½¿ç”¨ SSD**
   - æ¨¡å‹åŠ è½½å’Œ I/O æ“ä½œæ›´å¿«

3. **å…³é—­ä¸å¿…è¦çš„åå°ç¨‹åº**
   - é‡Šæ”¾æ›´å¤šç³»ç»Ÿèµ„æº

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº Apple SHaRP æ¨¡å‹ï¼Œè¯·éµå®ˆç›¸å…³å¼€æºåè®®ã€‚

---

## ğŸ“¦ å¤‡ä»½ä¿¡æ¯

- **é‡æ„å‰å¤‡ä»½**: `tmp/1.28/app.py.before_refactor.py`
- **æ—¥æœŸ**: 2026-01-28
- **å†…å®¹**: é‡æ„å‰çš„å®Œæ•´ä»£ç 

å¦‚éœ€å›æ»šåˆ°é‡æ„å‰çš„ç‰ˆæœ¬ï¼š

```bash
copy tmp\1.28\app.py.before_refactor.py app.py
```

---

## ğŸ”® æœªæ¥æ”¹è¿›

### å·²å®Œæˆ âœ…
- âœ… å•å…ƒæµ‹è¯•: ä¸ºæ¯ä¸ªç±»æ·»åŠ å•å…ƒæµ‹è¯•
- âœ… é…ç½®æ–‡ä»¶: æ”¯æŒä»é…ç½®æ–‡ä»¶åŠ è½½é…ç½®
- âœ… æ—¥å¿—ç³»ç»Ÿ: ä½¿ç”¨ä¸“ä¸šçš„æ—¥å¿—åº“ï¼ˆå¦‚ loguruï¼‰
- âœ… å¼‚æ­¥ä¼˜åŒ–: è¿›ä¸€æ­¥ä¼˜åŒ–å¼‚æ­¥å¤„ç†

### å¾…æ”¹è¿› ğŸ”„
#### é«˜ä¼˜å…ˆçº§
1. ~~**ç›‘æ§æŒ‡æ ‡** - æ·»åŠ æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†~~ âœ… å·²å®Œæˆ
   - ~~Prometheus é›†æˆ~~ âœ…
   - ~~å®æ—¶æ€§èƒ½ä»ªè¡¨æ¿~~ âœ…
   - ~~è¯·æ±‚å“åº”æ—¶é—´ç»Ÿè®¡~~ âœ…
   - ~~GPU åˆ©ç”¨ç‡ç›‘æ§~~ âœ…

2. ~~**æ¢¯åº¦æ£€æŸ¥ç‚¹** - å‡å°‘æ˜¾å­˜å ç”¨~~ âœ… å·²å®Œæˆ
   - ~~æ¢¯åº¦æ£€æŸ¥ç‚¹åŠŸèƒ½~~ âœ…
   - ~~å¯é…ç½®é€‰é¡¹~~ âœ…
   - ~~è¯¦ç»†æ–‡æ¡£~~ âœ…

3. **API æ–‡æ¡£** - è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
   - Swagger/OpenAPI é›†æˆ
   - äº¤äº’å¼ API æµ‹è¯•ç•Œé¢
   - è¯·æ±‚/å“åº”ç¤ºä¾‹

3. **è®¤è¯æˆæƒ** - æ·»åŠ ç”¨æˆ·è®¤è¯
   - API Key è®¤è¯
   - JWT Token æ”¯æŒ
   - é€Ÿç‡é™åˆ¶

#### ä¸­ä¼˜å…ˆçº§
4. **ä»»åŠ¡é˜Ÿåˆ—** - å¼‚æ­¥ä»»åŠ¡å¤„ç†
   - Redis é˜Ÿåˆ—æ”¯æŒ
   - ä»»åŠ¡çŠ¶æ€è¿½è¸ª
   - æ‰¹é‡å¤„ç†æ”¯æŒ

5. **ç¼“å­˜æœºåˆ¶** - æå‡å“åº”é€Ÿåº¦
   - Redis ç¼“å­˜
   - ç»“æœç¼“å­˜
   - é¢„æµ‹ç»“æœç¼“å­˜

6. **Webhook æ”¯æŒ** - å¼‚æ­¥é€šçŸ¥
   - ä»»åŠ¡å®Œæˆé€šçŸ¥
   - é”™è¯¯é€šçŸ¥
   - è‡ªå®šä¹‰å›è°ƒ

#### ä½ä¼˜å…ˆçº§
7. **å›½é™…åŒ–** - å¤šè¯­è¨€æ”¯æŒ
   - i18n æ”¯æŒ
   - ä¸­è‹±æ–‡ç•Œé¢
   - å¯æ‰©å±•è¯­è¨€åŒ…

8. **æ’ä»¶ç³»ç»Ÿ** - å¯æ‰©å±•æ¶æ„
   - è‡ªå®šä¹‰æ’ä»¶
   - æ¨¡å‹æ’ä»¶
   - åå¤„ç†æ’ä»¶

9. **æ‰¹å¤„ç† API** - æ‰¹é‡å›¾ç‰‡å¤„ç†
   - å¤šæ–‡ä»¶ä¸Šä¼ 
   - æ‰¹é‡é¢„æµ‹
   - ç»“æœæ‰“åŒ…ä¸‹è½½

## ğŸ“® è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: [https://github.com/ChidcGithub/MLSharp-3D-Maker-GPU](https://github.com/ChidcGithub/MLSharp-3D-Maker-GPU)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/ChidcGithub/MLSharp-3D-Maker-GPU/issues)

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Starï¼**

Modded with â¤ï¸ by Chidc with Provider DoDo

</div>
